services:
  postgres:
    image: postgres:16.6
    container_name: postman-runner-postgres
    environment:
      POSTGRES_USER: dev
      POSTGRES_PASSWORD: localdb
      POSTGRES_DB: postman_runner_db
    ports:
      - '5432:5432'
    volumes:
      - ./docker/pgdata:/var/lib/postgresql/data

  redis:
    image: redis:latest
    container_name: postman-runner-redis
    ports:
      - '6379:6379'
    volumes:
      - ./docker/redisdata:/data

  app:
    build:
      context: .
      dockerfile: dockerfile
    container_name: postman-runner-app
    ports:
      - '8080:8080'
    environment:
      - DB_HOST=postgres
      - DB_PORT=5432
      - DB_USER=dev
      - DB_PASSWORD=localdb
      - DB_NAME=postman_runner_db
      - DB_SSLMODE=disable
      - PORT=8080
      - REQUEST_TIMEOUT=30s
      - MAX_REQUEST_SIZE=10485760
      - MAX_RESPONSE_SIZE=52428800
      - MAX_HEADER_COUNT=50
      - RATE_LIMIT_RPS=10
    depends_on:
      - postgres
      - redis
